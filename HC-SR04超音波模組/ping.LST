C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PING
OBJECT MODULE PLACED IN ping.OBJ
COMPILER INVOKED BY: D:\KEILC 4\C51\BIN\C51.EXE ping.c BROWSE DEBUG OBJECTEXTEND CODE

line level    source

   1          #include "reg51.h"
   2          #include "intrins.h"
   3          
   4          sbit sig=0xb2;
   5          sbit EC=0xb3;
   6          
   7          unsigned int cm=0;
   8          unsigned char sample=0;
   9          unsigned char num=0;
  10          unsigned char scanline=0x08;
  11          unsigned char seg[10] =
  12          {
  13              0xC0, 0xf9, 0xa4, 0xb0, 0x99,
  14              0x92, 0x82, 0xf8, 0x80, 0x90
  15          };
  16          unsigned char buf[4] = {0, 0, 0, 0};
  17          void delayMicroseconds(unsigned int);
  18          void convert(unsigned int);
  19          void ping(void);
  20          
  21          main(void)
  22          {
  23   1          EA=1;
  24   1          ET1=1;
  25   1          TMOD=0x19;
  26   1          TH1=(65536-5000)/256;
  27   1          TL1=(65536-5000)/256;
  28   1          TR1=1;
  29   1          P1=0xff;
  30   1          while(1)
  31   1          {
  32   2              ping();
  33   2              sample++;
  34   2              if(sample>= 50)
  35   2              {
  36   3                  sample=0;
  37   3                  if(cm >= 2 && cm <= 300)
  38   3                  {
  39   4                      convert(cm);
  40   4                  }
  41   3              }
  42   2          }
  43   1      }
  44          void ping(void)
  45          {
  46   1          unsigned int temp;
  47   1          sig=0;
  48   1          sig=1;
  49   1          delayMicroseconds(5);
  50   1          sig=0;
  51   1          sig=1;
  52   1          TH0=0;
  53   1          TL0=0;
  54   1          TR0=1;
  55   1          while(EC==0);
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 2   

  56   1          while(EC==1);
  57   1          TR0=0;
  58   1          temp=TH0;
  59   1          temp=(temp<<8)|TL0;
  60   1          cm=temp/58-12;
  61   1          delayMicroseconds(200);
  62   1      }
  63          
  64          void delayMicroseconds(unsigned int count)
  65          {
  66   1          unsigned int i;
  67   1          for(i=0; i<count-4; i++)
  68   1          {
  69   2              _nop_();
  70   2          }
  71   1      }
  72          
  73          void convert(unsigned int distance)
  74          {
  75   1          buf[0]=distance/1000;
  76   1          buf[1]=(distance%1000)/100;
  77   1          buf[2]=(distance%100)/10;
  78   1          buf[3]=distance%10;
  79   1      }
  80          void T1_int(void) interrupt 3
  81          {
  82   1          TH1=(65536-5000)/256;
  83   1          TL1=(65536-5000)%256;
  84   1          scanline>>=1;
  85   1          num++;
  86   1          if(scanline==0)
  87   1          {
  88   2              scanline=0x08;
  89   2              num=0;
  90   2          }
  91   1          P1=0xff;
  92   1          P2=~scanline;
  93   1          P1=seg[buf[num]];
  94   1      }
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
                                           ; SOURCE LINE # 23
0000 D2AF              SETB    EA
                                           ; SOURCE LINE # 24
0002 D2AB              SETB    ET1
                                           ; SOURCE LINE # 25
0004 758919            MOV     TMOD,#019H
                                           ; SOURCE LINE # 26
0007 758DEC            MOV     TH1,#0ECH
                                           ; SOURCE LINE # 27
000A 758BEC            MOV     TL1,#0ECH
                                           ; SOURCE LINE # 28
000D D28E              SETB    TR1
                                           ; SOURCE LINE # 29
000F 7590FF            MOV     P1,#0FFH
0012         ?C0001:
                                           ; SOURCE LINE # 30
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 32
0012 120000      R     LCALL   ping
                                           ; SOURCE LINE # 33
0015 0500        R     INC     sample
                                           ; SOURCE LINE # 34
0017 E500        R     MOV     A,sample
0019 C3                CLR     C
001A 9432              SUBB    A,#032H
001C 40F4              JC      ?C0001
                                           ; SOURCE LINE # 35
                                           ; SOURCE LINE # 36
001E E4                CLR     A
001F F500        R     MOV     sample,A
                                           ; SOURCE LINE # 37
0021 E500        R     MOV     A,cm+01H
0023 9402              SUBB    A,#02H
0025 E500        R     MOV     A,cm
0027 9400              SUBB    A,#00H
0029 40E7              JC      ?C0001
002B D3                SETB    C
002C E500        R     MOV     A,cm+01H
002E 942C              SUBB    A,#02CH
0030 E500        R     MOV     A,cm
0032 9401              SUBB    A,#01H
0034 50DC              JNC     ?C0001
                                           ; SOURCE LINE # 38
                                           ; SOURCE LINE # 39
0036 AF00        R     MOV     R7,cm+01H
0038 AE00        R     MOV     R6,cm
003A 120000      R     LCALL   _convert
                                           ; SOURCE LINE # 40
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
003D 80D3              SJMP    ?C0001
             ; FUNCTION main (END)

             ; FUNCTION ping (BEGIN)
                                           ; SOURCE LINE # 44
                                           ; SOURCE LINE # 45
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 4   

                                           ; SOURCE LINE # 47
0000 C2B2              CLR     sig
                                           ; SOURCE LINE # 48
0002 D2B2              SETB    sig
                                           ; SOURCE LINE # 49
0004 7F05              MOV     R7,#05H
0006 7E00              MOV     R6,#00H
0008 120000      R     LCALL   _delayMicroseconds
                                           ; SOURCE LINE # 50
000B C2B2              CLR     sig
                                           ; SOURCE LINE # 51
000D D2B2              SETB    sig
                                           ; SOURCE LINE # 52
000F E4                CLR     A
0010 F58C              MOV     TH0,A
                                           ; SOURCE LINE # 53
0012 F58A              MOV     TL0,A
                                           ; SOURCE LINE # 54
0014 D28C              SETB    TR0
0016         ?C0006:
                                           ; SOURCE LINE # 55
0016 30B3FD            JNB     EC,?C0006
0019         ?C0007:
0019         ?C0008:
                                           ; SOURCE LINE # 56
0019 20B3FD            JB      EC,?C0008
001C         ?C0009:
                                           ; SOURCE LINE # 57
001C C28C              CLR     TR0
                                           ; SOURCE LINE # 58
001E AF8C              MOV     R7,TH0
;---- Variable 'temp' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 59
0020 EF                MOV     A,R7
0021 FE                MOV     R6,A
0022 AD8A              MOV     R5,TL0
0024 ED                MOV     A,R5
0025 FF                MOV     R7,A
                                           ; SOURCE LINE # 60
0026 7C00              MOV     R4,#00H
0028 7D3A              MOV     R5,#03AH
002A 120000      E     LCALL   ?C?UIDIV
002D EF                MOV     A,R7
002E 24F4              ADD     A,#0F4H
0030 F500        R     MOV     cm+01H,A
0032 EE                MOV     A,R6
0033 34FF              ADDC    A,#0FFH
0035 F500        R     MOV     cm,A
                                           ; SOURCE LINE # 61
0037 7FC8              MOV     R7,#0C8H
0039 7E00              MOV     R6,#00H
003B 020000      R     LJMP    _delayMicroseconds
             ; FUNCTION ping (END)

             ; FUNCTION _delayMicroseconds (BEGIN)
                                           ; SOURCE LINE # 64
;---- Variable 'count' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 65
                                           ; SOURCE LINE # 67
;---- Variable 'i' assigned to Register 'R4/R5' ----
0000 E4                CLR     A
0001 FD                MOV     R5,A
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 5   

0002 FC                MOV     R4,A
0003         ?C0011:
0003 EF                MOV     A,R7
0004 24FC              ADD     A,#0FCH
0006 FB                MOV     R3,A
0007 EE                MOV     A,R6
0008 34FF              ADDC    A,#0FFH
000A FA                MOV     R2,A
000B C3                CLR     C
000C ED                MOV     A,R5
000D 9B                SUBB    A,R3
000E EC                MOV     A,R4
000F 9A                SUBB    A,R2
0010 5008              JNC     ?C0014
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 69
0012 00                NOP     
                                           ; SOURCE LINE # 70
0013 0D                INC     R5
0014 BD0001            CJNE    R5,#00H,?C0018
0017 0C                INC     R4
0018         ?C0018:
0018 80E9              SJMP    ?C0011
                                           ; SOURCE LINE # 71
001A         ?C0014:
001A 22                RET     
             ; FUNCTION _delayMicroseconds (END)

             ; FUNCTION _convert (BEGIN)
                                           ; SOURCE LINE # 73
;---- Variable 'distance' assigned to Register 'R2/R3' ----
0000 AB07              MOV     R3,AR7
0002 AA06              MOV     R2,AR6
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 75
0004 7C03              MOV     R4,#03H
0006 7DE8              MOV     R5,#0E8H
0008 120000      E     LCALL   ?C?UIDIV
000B 8F00        R     MOV     buf,R7
                                           ; SOURCE LINE # 76
000D 7C03              MOV     R4,#03H
000F 7DE8              MOV     R5,#0E8H
0011 AF03              MOV     R7,AR3
0013 AE02              MOV     R6,AR2
0015 120000      E     LCALL   ?C?UIDIV
0018 7E00              MOV     R6,#00H
001A 7F64              MOV     R7,#064H
001C CF                XCH     A,R7
001D CD                XCH     A,R5
001E CF                XCH     A,R7
001F CE                XCH     A,R6
0020 CC                XCH     A,R4
0021 CE                XCH     A,R6
0022 120000      E     LCALL   ?C?UIDIV
0025 8F00        R     MOV     buf+01H,R7
                                           ; SOURCE LINE # 77
0027 7C00              MOV     R4,#00H
0029 7D64              MOV     R5,#064H
002B AF03              MOV     R7,AR3
002D AE02              MOV     R6,AR2
002F 120000      E     LCALL   ?C?UIDIV
0032 7E00              MOV     R6,#00H
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 6   

0034 7F0A              MOV     R7,#0AH
0036 CF                XCH     A,R7
0037 CD                XCH     A,R5
0038 CF                XCH     A,R7
0039 CE                XCH     A,R6
003A CC                XCH     A,R4
003B CE                XCH     A,R6
003C 120000      E     LCALL   ?C?UIDIV
003F 8F00        R     MOV     buf+02H,R7
                                           ; SOURCE LINE # 78
0041 AE02              MOV     R6,AR2
0043 AF03              MOV     R7,AR3
0045 7C00              MOV     R4,#00H
0047 7D0A              MOV     R5,#0AH
0049 120000      E     LCALL   ?C?UIDIV
004C 8D00        R     MOV     buf+03H,R5
                                           ; SOURCE LINE # 79
004E 22                RET     
             ; FUNCTION _convert (END)

             ; FUNCTION T1_int (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0D0              PUSH    PSW
0004 75D000            MOV     PSW,#00H
0007 C000              PUSH    AR0
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 82
0009 758DEC            MOV     TH1,#0ECH
                                           ; SOURCE LINE # 83
000C 758B78            MOV     TL1,#078H
                                           ; SOURCE LINE # 84
000F E500        R     MOV     A,scanline
0011 C3                CLR     C
0012 13                RRC     A
0013 F500        R     MOV     scanline,A
                                           ; SOURCE LINE # 85
0015 0500        R     INC     num
                                           ; SOURCE LINE # 86
0017 7005              JNZ     ?C0016
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
0019 750008      R     MOV     scanline,#08H
                                           ; SOURCE LINE # 89
001C F500        R     MOV     num,A
                                           ; SOURCE LINE # 90
001E         ?C0016:
                                           ; SOURCE LINE # 91
001E 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 92
0021 E500        R     MOV     A,scanline
0023 F4                CPL     A
0024 F5A0              MOV     P2,A
                                           ; SOURCE LINE # 93
0026 7400        R     MOV     A,#LOW buf
0028 2500        R     ADD     A,num
002A F8                MOV     R0,A
002B E6                MOV     A,@R0
002C 2400        R     ADD     A,#LOW seg
002E F8                MOV     R0,A
002F E6                MOV     A,@R0
0030 F590              MOV     P1,A
                                           ; SOURCE LINE # 94
C51 COMPILER V9.00   PING                                                                  03/15/2019 16:14:01 PAGE 7   

0032 D000              POP     AR0
0034 D0D0              POP     PSW
0036 D0E0              POP     ACC
0038 32                RETI    
             ; FUNCTION T1_int (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    288    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
