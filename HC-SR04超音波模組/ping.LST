C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PING
OBJECT MODULE PLACED IN ping.OBJ
COMPILER INVOKED BY: D:\KEILC 4\C51\BIN\C51.EXE ping.c BROWSE DEBUG OBJECTEXTEND CODE

line level    source

   1          #include "reg51.h"
   2          #include "intrins.h"
   3          
   4          sbit trig_pin=P2^6;
   5          sbit echo_pin=P3^2;
   6          
   7          unsigned int cm=6666;
   8          unsigned char sample=0;
   9          unsigned char num=0;
  10          unsigned char scanline=0x08;
  11          unsigned char seg[10] =
  12          {
  13              0xC0, 0xf9, 0xa4, 0xb0, 0x99,
  14              0x92, 0x82, 0xf8, 0x80, 0x90
  15          };
  16          unsigned char buf[4] = {0, 0, 0, 0};
  17          void delayMicroseconds(unsigned int);
  18          void convert(unsigned int);
  19          void ping(void);
  20          
  21          void Delay_us()
  22          {
  23   1              TL0=0xF5;
  24   1              TH0=0xFF;
  25   1              TR0=1;
  26   1              while (TF0==0);
  27   1              TR0=0;
  28   1              TF0=0;
  29   1      }
  30          
  31          main(void)
  32          {
  33   1          EA=1;
  34   1          ET1=1;
  35   1          TMOD=0x11;
  36   1          TH1=(65536-5000)/256;
  37   1          TL1=(65536-5000)/256;
  38   1          TR1=1;
  39   1          P1=0xff;
  40   1          while(1)
  41   1          {
  42   2              ping();
  43   2              sample++;
  44   2              if(sample >= 50)
  45   2              {
  46   3                  sample=0;
  47   3                  
  48   3                  //if(cm >= 2 && cm <= 300)
  49   3                  //{
  50   3                      convert(cm);
  51   3                  //}
  52   3                 //convert(9487);
  53   3              }
  54   2          }
  55   1      }
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 2   

  56          void ping(void)
  57          {
  58   1          unsigned int temp;
  59   1          trig_pin=1;
  60   1          Delay_us();
  61   1          trig_pin=0;
  62   1      
  63   1          while(!echo_pin);
  64   1          TR0=1;
  65   1          while(echo_pin && !TF0 && TH0 < 0x38);
  66   1          TR0=0;
  67   1          temp=TH0;
  68   1          temp=(temp << 8) | TL0;
  69   1          cm = temp / 58;
  70   1          delayMicroseconds(200);
  71   1      }
  72          
  73          void delayMicroseconds(unsigned int count)
  74          {
  75   1          unsigned int i;
  76   1          for(i=0; i<count-4; i++)
  77   1          {
  78   2              _nop_();
  79   2          }
  80   1      }
  81          
  82          void convert(unsigned int distance)
  83          {
  84   1          buf[3]=distance/1000;
  85   1          buf[2]=(distance%1000)/100;
  86   1          buf[1]=(distance%100)/10;
  87   1          buf[0]=distance%10;
  88   1      }
  89          
  90          
  91          void T1_int(void) interrupt 3
  92          {
  93   1          TH1 = (65536-5000) / 256;
  94   1          TL1 = (65536-5000) % 256;
  95   1          scanline >>= 1; 
  96   1          num++;
  97   1          if(scanline == 0)
  98   1          {
  99   2              scanline = 0x08;
 100   2              num = 0;
 101   2          }
 102   1          P1 = 0xff;
 103   1          P2 = ~scanline;
 104   1          P1 = seg[buf[num]];
 105   1      }
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION Delay_us (BEGIN)
                                           ; SOURCE LINE # 21
                                           ; SOURCE LINE # 22
                                           ; SOURCE LINE # 23
0000 758AF5            MOV     TL0,#0F5H
                                           ; SOURCE LINE # 24
0003 758CFF            MOV     TH0,#0FFH
                                           ; SOURCE LINE # 25
0006 D28C              SETB    TR0
0008         ?C0001:
                                           ; SOURCE LINE # 26
0008 308DFD            JNB     TF0,?C0001
000B         ?C0002:
                                           ; SOURCE LINE # 27
000B C28C              CLR     TR0
                                           ; SOURCE LINE # 28
000D C28D              CLR     TF0
                                           ; SOURCE LINE # 29
000F 22                RET     
             ; FUNCTION Delay_us (END)

             ; FUNCTION main (BEGIN)
                                           ; SOURCE LINE # 31
                                           ; SOURCE LINE # 32
                                           ; SOURCE LINE # 33
0000 D2AF              SETB    EA
                                           ; SOURCE LINE # 34
0002 D2AB              SETB    ET1
                                           ; SOURCE LINE # 35
0004 758911            MOV     TMOD,#011H
                                           ; SOURCE LINE # 36
0007 758DEC            MOV     TH1,#0ECH
                                           ; SOURCE LINE # 37
000A 758BEC            MOV     TL1,#0ECH
                                           ; SOURCE LINE # 38
000D D28E              SETB    TR1
                                           ; SOURCE LINE # 39
000F 7590FF            MOV     P1,#0FFH
0012         ?C0004:
                                           ; SOURCE LINE # 40
                                           ; SOURCE LINE # 41
                                           ; SOURCE LINE # 42
0012 120000      R     LCALL   ping
                                           ; SOURCE LINE # 43
0015 0500        R     INC     sample
                                           ; SOURCE LINE # 44
0017 E500        R     MOV     A,sample
0019 C3                CLR     C
001A 9432              SUBB    A,#032H
001C 40F4              JC      ?C0004
                                           ; SOURCE LINE # 45
                                           ; SOURCE LINE # 46
001E E4                CLR     A
001F F500        R     MOV     sample,A
                                           ; SOURCE LINE # 50
0021 AF00        R     MOV     R7,cm+01H
0023 AE00        R     MOV     R6,cm
0025 120000      R     LCALL   _convert
                                           ; SOURCE LINE # 53
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 4   

                                           ; SOURCE LINE # 54
0028 80E8              SJMP    ?C0004
             ; FUNCTION main (END)

             ; FUNCTION ping (BEGIN)
                                           ; SOURCE LINE # 56
                                           ; SOURCE LINE # 57
                                           ; SOURCE LINE # 59
0000 D2A6              SETB    trig_pin
                                           ; SOURCE LINE # 60
0002 120000      R     LCALL   Delay_us
                                           ; SOURCE LINE # 61
0005 C2A6              CLR     trig_pin
0007         ?C0008:
                                           ; SOURCE LINE # 63
0007 30B2FD            JNB     echo_pin,?C0008
000A         ?C0009:
                                           ; SOURCE LINE # 64
000A D28C              SETB    TR0
000C         ?C0010:
                                           ; SOURCE LINE # 65
000C 30B20A            JNB     echo_pin,?C0011
000F 208D07            JB      TF0,?C0011
0012 E58C              MOV     A,TH0
0014 C3                CLR     C
0015 9438              SUBB    A,#038H
0017 40F3              JC      ?C0010
0019         ?C0011:
                                           ; SOURCE LINE # 66
0019 C28C              CLR     TR0
                                           ; SOURCE LINE # 67
001B AF8C              MOV     R7,TH0
;---- Variable 'temp' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 68
001D EF                MOV     A,R7
001E FE                MOV     R6,A
001F AD8A              MOV     R5,TL0
0021 ED                MOV     A,R5
0022 FF                MOV     R7,A
                                           ; SOURCE LINE # 69
0023 7C00              MOV     R4,#00H
0025 7D3A              MOV     R5,#03AH
0027 120000      E     LCALL   ?C?UIDIV
002A 8E00        R     MOV     cm,R6
002C 8F00        R     MOV     cm+01H,R7
                                           ; SOURCE LINE # 70
002E 7FC8              MOV     R7,#0C8H
0030 7E00              MOV     R6,#00H
0032 020000      R     LJMP    _delayMicroseconds
             ; FUNCTION ping (END)

             ; FUNCTION _delayMicroseconds (BEGIN)
                                           ; SOURCE LINE # 73
;---- Variable 'count' assigned to Register 'R6/R7' ----
                                           ; SOURCE LINE # 74
                                           ; SOURCE LINE # 76
;---- Variable 'i' assigned to Register 'R4/R5' ----
0000 E4                CLR     A
0001 FD                MOV     R5,A
0002 FC                MOV     R4,A
0003         ?C0013:
0003 EF                MOV     A,R7
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 5   

0004 24FC              ADD     A,#0FCH
0006 FB                MOV     R3,A
0007 EE                MOV     A,R6
0008 34FF              ADDC    A,#0FFH
000A FA                MOV     R2,A
000B C3                CLR     C
000C ED                MOV     A,R5
000D 9B                SUBB    A,R3
000E EC                MOV     A,R4
000F 9A                SUBB    A,R2
0010 5008              JNC     ?C0016
                                           ; SOURCE LINE # 77
                                           ; SOURCE LINE # 78
0012 00                NOP     
                                           ; SOURCE LINE # 79
0013 0D                INC     R5
0014 BD0001            CJNE    R5,#00H,?C0020
0017 0C                INC     R4
0018         ?C0020:
0018 80E9              SJMP    ?C0013
                                           ; SOURCE LINE # 80
001A         ?C0016:
001A 22                RET     
             ; FUNCTION _delayMicroseconds (END)

             ; FUNCTION _convert (BEGIN)
                                           ; SOURCE LINE # 82
;---- Variable 'distance' assigned to Register 'R2/R3' ----
0000 AB07              MOV     R3,AR7
0002 AA06              MOV     R2,AR6
                                           ; SOURCE LINE # 83
                                           ; SOURCE LINE # 84
0004 7C03              MOV     R4,#03H
0006 7DE8              MOV     R5,#0E8H
0008 120000      E     LCALL   ?C?UIDIV
000B 8F00        R     MOV     buf+03H,R7
                                           ; SOURCE LINE # 85
000D 7C03              MOV     R4,#03H
000F 7DE8              MOV     R5,#0E8H
0011 AF03              MOV     R7,AR3
0013 AE02              MOV     R6,AR2
0015 120000      E     LCALL   ?C?UIDIV
0018 7E00              MOV     R6,#00H
001A 7F64              MOV     R7,#064H
001C CF                XCH     A,R7
001D CD                XCH     A,R5
001E CF                XCH     A,R7
001F CE                XCH     A,R6
0020 CC                XCH     A,R4
0021 CE                XCH     A,R6
0022 120000      E     LCALL   ?C?UIDIV
0025 8F00        R     MOV     buf+02H,R7
                                           ; SOURCE LINE # 86
0027 7C00              MOV     R4,#00H
0029 7D64              MOV     R5,#064H
002B AF03              MOV     R7,AR3
002D AE02              MOV     R6,AR2
002F 120000      E     LCALL   ?C?UIDIV
0032 7E00              MOV     R6,#00H
0034 7F0A              MOV     R7,#0AH
0036 CF                XCH     A,R7
0037 CD                XCH     A,R5
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 6   

0038 CF                XCH     A,R7
0039 CE                XCH     A,R6
003A CC                XCH     A,R4
003B CE                XCH     A,R6
003C 120000      E     LCALL   ?C?UIDIV
003F 8F00        R     MOV     buf+01H,R7
                                           ; SOURCE LINE # 87
0041 AE02              MOV     R6,AR2
0043 AF03              MOV     R7,AR3
0045 7C00              MOV     R4,#00H
0047 7D0A              MOV     R5,#0AH
0049 120000      E     LCALL   ?C?UIDIV
004C 8D00        R     MOV     buf,R5
                                           ; SOURCE LINE # 88
004E 22                RET     
             ; FUNCTION _convert (END)

             ; FUNCTION T1_int (BEGIN)
0000 C0E0              PUSH    ACC
0002 C0D0              PUSH    PSW
0004 75D000            MOV     PSW,#00H
0007 C000              PUSH    AR0
                                           ; SOURCE LINE # 91
                                           ; SOURCE LINE # 93
0009 758DEC            MOV     TH1,#0ECH
                                           ; SOURCE LINE # 94
000C 758B78            MOV     TL1,#078H
                                           ; SOURCE LINE # 95
000F E500        R     MOV     A,scanline
0011 C3                CLR     C
0012 13                RRC     A
0013 F500        R     MOV     scanline,A
                                           ; SOURCE LINE # 96
0015 0500        R     INC     num
                                           ; SOURCE LINE # 97
0017 7005              JNZ     ?C0018
                                           ; SOURCE LINE # 98
                                           ; SOURCE LINE # 99
0019 750008      R     MOV     scanline,#08H
                                           ; SOURCE LINE # 100
001C F500        R     MOV     num,A
                                           ; SOURCE LINE # 101
001E         ?C0018:
                                           ; SOURCE LINE # 102
001E 7590FF            MOV     P1,#0FFH
                                           ; SOURCE LINE # 103
0021 E500        R     MOV     A,scanline
0023 F4                CPL     A
0024 F5A0              MOV     P2,A
                                           ; SOURCE LINE # 104
0026 7400        R     MOV     A,#LOW buf
0028 2500        R     ADD     A,num
002A F8                MOV     R0,A
002B E6                MOV     A,@R0
002C 2400        R     ADD     A,#LOW seg
002E F8                MOV     R0,A
002F E6                MOV     A,@R0
0030 F590              MOV     P1,A
                                           ; SOURCE LINE # 105
0032 D000              POP     AR0
0034 D0D0              POP     PSW
0036 D0E0              POP     ACC
C51 COMPILER V9.00   PING                                                                  04/29/2019 23:44:33 PAGE 7   

0038 32                RETI    
             ; FUNCTION T1_int (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    274    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
