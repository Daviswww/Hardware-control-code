C51 COMPILER V9.00   AUTOCARII                                                             05/15/2019 18:10:43 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE AUTOCARII
OBJECT MODULE PLACED IN AUTOCARII.OBJ
COMPILER INVOKED BY: D:\KEILC 4\C51\BIN\C51.EXE AUTOCARII.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "reg51.h"
   2          sbit LED1=0xA1;
   3          sbit ECHO=0xB2;
   4          sbit TRIG=0xA0;
   5          sbit D0=0xA4;
   6          sbit D1=0xA5;
   7          sbit D2=0xA6;
   8          sbit D3=0xA7;
   9          unsigned char j;
  10          unsigned char AUTO;
  11          unsigned char SBUFTMP;
  12          unsigned char DIST, SDIST;
  13          unsigned char MYCHAR, TMPCHAR;
  14          unsigned char buf[4] = {0, 0, 0, 0};
  15          unsigned char seg[10] =
  16          {
  17              0xC0, 0xf9, 0xa4, 0xb0, 0x99,
  18              0x92, 0x82, 0xf8, 0x80, 0x90
  19          };
  20          void main(void)
  21          {
  22   1          void delay(unsigned int);
  23   1          void convert(unsigned int);
  24   1          for(j = 0 ; j < 4; j++)
  25   1          {
  26   2              LED1=0x00;
  27   2              delay(10000);
  28   2              LED1=0xFF;
  29   2              delay(10000);
  30   2          }
  31   1          ES=1;           //Serial
  32   1          EA=1;           //Timer
  33   1      
  34   1          TMOD=0x21;      //00100001
  35   1          SCON=0x50;      //01010000
  36   1          PCON=0x00;
  37   1          AUTO=0xFF;      //set
  38   1          TH1=0xFD;       //253
  39   1          TR1=1;          //open timer 1
  40   1      
  41   1          ET0=1;
  42   1          ET1=1;
  43   1          TH0=(65536-20000)/256;
  44   1          TL0=(65536-20000)%256;
  45   1          TR0=1;          //open timer 0
  46   1          //7SEG
  47   1          P1=0xff;
  48   1          while(1)
  49   1          {
  50   2                      DIST = 0x00; // Reset DIST
  51   2                      TRIG = 1; // Trig for ULTRASONIC
  52   2                      delay(1); // 12 us
  53   2                      TRIG = 0; // Trig for ULTRASONIC                
  54   2                      delay(33); // 400 us
  55   2                      while(ECHO == 1) // echo on
C51 COMPILER V9.00   AUTOCARII                                                             05/15/2019 18:10:43 PAGE 2   

  56   2                      {
  57   3                              delay(5); // 5*12us = 60us approximately 58.8us
  58   3                              DIST = DIST + 1; // distance increases 1cm
  59   3                              if (DIST > 250)
  60   3                              {
  61   4                                      DIST = 250;
  62   4                              }
  63   3                      }
  64   2              SDIST=DIST;
  65   2              convert(SDIST);
  66   2              P2 = 0x0E;
  67   2              P0 = seg[buf[3]];
  68   2              P2 = 0x0D;
  69   2              P0 = seg[buf[2]];
  70   2              P2 = 0x0B;
  71   2              P0 = seg[buf[1]];
  72   2              P2 = 0x07;
  73   2              P0 = seg[buf[0]];
  74   2              if(AUTO==0x00)
  75   2              {
  76   3                              if (SDIST > 10)
  77   3                              {
  78   4                                      P1 = 0x0A; // Forward run #00001010
  79   4                              }
  80   3                              else
  81   3                              {
  82   4                                      P1 = 0x00; // motor stop
  83   4                                      delay(8333); // 8333*12us = 0.1 sec
  84   4                                      P1 = 0x06; // motor turn left #00000110
  85   4                                      delay(41667); // 41667*12us = 0.5sec
  86   4                                      P1 = 0x00; // motor stop
  87   4                              }
  88   3              }
  89   2          }
  90   1      }
  91          void qwe(void) interrupt 4
  92          {
  93   1          if(RI==1)
  94   1          {
  95   2              RI = 0;
  96   2              MYCHAR = SBUF;
  97   2              LED1=0x00;
  98   2              delay(1000);
  99   2              LED1=0xFF;
 100   2              delay(1000);
 101   2          }
 102   1          if(MYCHAR == 'E')
 103   1          {
 104   2              AUTO= 0xFF;
 105   2              P1 = 0x00;
 106   2          }
 107   1          else if(MYCHAR == 'R')
 108   1          {
 109   2              AUTO= 0x00;
 110   2              P1 = 0x00;
 111   2          }
 112   1      }
 113          void asd(void) interrupt 1
 114          {
 115   1              TR0=0;
 116   1              TH0  = (65536-20000)/256;
 117   1              TL0  = (65536-20000)%256;
C51 COMPILER V9.00   AUTOCARII                                                             05/15/2019 18:10:43 PAGE 3   

 118   1              TR0=1;
 119   1      
 120   1          if(AUTO==0xFF)
 121   1          {
 122   2              if(MYCHAR == 'W')
 123   2              {
 124   3                  P1 = 0x0A; // motor forward, #00001010B
 125   3              }
 126   2              else if(MYCHAR == 'A')
 127   2              {
 128   3                  P1 = 0x06; // motor left,    #00000110B
 129   3              }
 130   2              else if(MYCHAR == 'S')
 131   2              {
 132   3                  P1 = 0x05; // motor back,    #00000101B
 133   3      
 134   3              }
 135   2              else if(MYCHAR == 'D')
 136   2              {
 137   3                  P1 = 0x09; // motor right,   #00001001B
 138   3              }
 139   2              else if(MYCHAR == 'Q')
 140   2              {
 141   3                  P1 = 0x00; // motor stop
 142   3              }
 143   2          }
 144   1      
 145   1      }
 146          void convert(unsigned int distance)
 147          {
 148   1          buf[3]=distance/1000;
 149   1          buf[2]=(distance%1000)/100;
 150   1          buf[1]=(distance%100)/10;
 151   1          buf[0]=distance%10;
 152   1      }
 153          
 154          void delay(unsigned int count)
 155          {
 156   1              unsigned int i;
 157   1              for(i = 0; i < count; i++);
 158   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    478    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     21    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
